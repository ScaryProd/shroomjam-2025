[gd_scene load_steps=5 format=3 uid="uid://bcqm5htu1jq70"]

[ext_resource type="Texture2D" uid="uid://m6u4ipyonkr3" path="res://assets/sprites/items/gems/green.png" id="1_enx4o"]
[ext_resource type="AudioStream" uid="uid://c2hordu3o70bp" path="res://assets/Sounds/collect.ogg" id="2_nrire"]

[sub_resource type="GDScript" id="GDScript_enx4o"]
script/source = "extends Area2D

@export var experience = 1

var spr_green = preload(\"res://assets/sprites/items/gems/green.png\")
var spr_blue = preload(\"res://assets/sprites/items/gems/blue.png\")
var spr_red = preload(\"res://assets/sprites/items/gems/red.png\")

var target = null
var speed = -1

var pitch = 1

@onready var sprite = $Sprite2D
@onready var collision = $CollisionShape2D
@onready var sound = $snd_collected

func _ready():
	if experience < 5:
		pitch = 1.5
		return
	elif experience < 25:
		pitch = 1.0
		sprite.texture = spr_blue
	else:
		pitch = 0.8
		sprite.texture = spr_red

func _physics_process(delta: float) -> void:
	
	if target != null:
		global_position = global_position.move_toward(target.global_position, speed)
		speed += 2*delta

func collect():
	sound.pitch_scale = pitch
	sound.play()
	collision.call_deferred(\"set\",\"disabled\")
	sprite.visible = false
	return experience

func _on_snd_collected_finished() -> void:
	queue_free()
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_enx4o"]
size = Vector2(20, 22)

[node name="ExperienceGem" type="Area2D" groups=["loot"]]
collision_layer = 8
collision_mask = 0
script = SubResource("GDScript_enx4o")

[node name="Sprite2D" type="Sprite2D" parent="."]
texture = ExtResource("1_enx4o")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(0, -2)
shape = SubResource("RectangleShape2D_enx4o")

[node name="snd_collected" type="AudioStreamPlayer" parent="."]
stream = ExtResource("2_nrire")
volume_db = -20.0
max_polyphony = 10

[connection signal="finished" from="snd_collected" to="." method="_on_snd_collected_finished"]
