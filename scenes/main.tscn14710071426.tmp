[gd_scene load_steps=10 format=3 uid="uid://xbm55sjeswt6"]

[ext_resource type="PackedScene" uid="uid://xchqv5y2yxly" path="res://scenes/World/world.tscn" id="1_0wfyh"]
[ext_resource type="PackedScene" uid="uid://cykduxlpxv01h" path="res://scenes/Utility/basic_button.tscn" id="3_sugp2"]
[ext_resource type="PackedScene" uid="uid://ccyfx7e3cmjvb" path="res://scenes/tvbackgroundscene.tscn" id="3_tipki"]
[ext_resource type="PackedScene" uid="uid://6kngjy7flue5" path="res://draggable.tscn" id="4_jyhfs"]
[ext_resource type="Texture2D" uid="uid://c38v5berwluq4" path="res://assets/newsprites/MagnetNEW.png" id="4_tefeu"]
[ext_resource type="Shader" uid="uid://cv7hfm5duhalc" path="res://addons/crt/crt.gdshader" id="5_o6xl0"]
[ext_resource type="Texture2D" uid="uid://cqb4p3k1vdrj5" path="res://assets/GUI/cameraSwitch.png" id="5_tbgi4"]

[sub_resource type="GDScript" id="GDScript_sugp2"]
resource_name = "mainscript"
script/source = "extends Node2D

@onready var camera = $Camera2D
@onready var tvStatic = $tvStatic
var zoomout = false

var tweenIn
var tweenOut

var currentGlitch = 0

@export var zoomamount: float


func _ready():
	zoomout = false
	currentGlitch = 0

func _on_btn_camera_click_end() -> void:
	print(\"script running\")
	zoomout = !zoomout
	if zoomout:
		#$Camera2D.zoom = Vector2(0.4, 0.4)
		tweenOut = camera.create_tween()
		tweenOut.tween_property(camera, \"zoom\", Vector2(zoomamount,zoomamount),1)
		tweenOut.play()
		
		
	else:
		#$Camera2D.zoom = Vector2(1, 1)
		tweenIn = camera.create_tween()
		tweenIn.tween_property(camera, \"zoom\", Vector2(1,1),1)
		tweenIn.play()


func _on_draggable_mouse_entered() -> void:
	print(\"mouse enter\")


func _on_glitchtimer_timeout() -> void:
	tvglitch()

func tvglitch() -> void:
	currentGlitch += 1
	match currentGlitch:
		1:
			tvStatic.material
		2:
			pass
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_tipki"]
shader = ExtResource("5_o6xl0")
shader_parameter/resolution = Vector2(640, 360)
shader_parameter/scan_line_amount = 1.0
shader_parameter/scan_line_strength = -8.0
shader_parameter/warp_amount = 0.1
shader_parameter/noise_amount = 0.03
shader_parameter/interference_amount = 0.2
shader_parameter/grille_amount = 0.1
shader_parameter/grille_size = 1.0
shader_parameter/vignette_amount = 0.6
shader_parameter/vignette_intensity = 0.4
shader_parameter/aberation_amount = 0.5
shader_parameter/roll_line_amount = 0.3
shader_parameter/roll_speed = 1.0
shader_parameter/pixel_strength = -2.0

[node name="main_node" type="Node2D"]
script = SubResource("GDScript_sugp2")
zoomamount = 0.3

[node name="tvbackgroundnode" parent="." instance=ExtResource("3_tipki")]
position = Vector2(-2, 28)
scale = Vector2(5.18, 5.3)

[node name="draggable" parent="." instance=ExtResource("4_jyhfs")]
position = Vector2(852, 597)
scale = Vector2(5, 5)

[node name="Sprite2D" parent="draggable" index="1"]
texture = ExtResource("4_tefeu")

[node name="Camera2D" type="Camera2D" parent="."]
ignore_rotation = false
position_smoothing_enabled = true

[node name="SubViewportContainer" type="SubViewportContainer" parent="."]
offset_left = -317.0
offset_top = -180.0
offset_right = 323.0
offset_bottom = 180.0
mouse_target = true

[node name="SubViewport" type="SubViewport" parent="SubViewportContainer"]
handle_input_locally = false
audio_listener_enable_2d = true
audio_listener_enable_3d = true
gui_snap_controls_to_pixels = false
size = Vector2i(640, 360)
render_target_update_mode = 4

[node name="World" parent="SubViewportContainer/SubViewport" instance=ExtResource("1_0wfyh")]

[node name="tvStatic" type="ColorRect" parent="."]
material = SubResource("ShaderMaterial_tipki")
offset_left = -319.0
offset_top = -180.0
offset_right = 320.0
offset_bottom = 182.0
mouse_filter = 2
color = Color(0.24976426, 0, 0.069391355, 1)

[node name="GUILayer_tv" type="CanvasLayer" parent="."]

[node name="Control" type="Control" parent="GUILayer_tv"]
layout_mode = 3
anchors_preset = 0
offset_right = 640.0
offset_bottom = 360.0
mouse_filter = 2

[node name="btn_camera" parent="GUILayer_tv/Control" instance=ExtResource("3_sugp2")]
z_index = 100
layout_mode = 0
offset_left = 13.0
offset_top = 277.0
offset_right = 182.0
offset_bottom = 396.0
scale = Vector2(0.5, 0.5)
text = ""
icon = ExtResource("5_tbgi4")

[node name="glitchtimer" type="Timer" parent="."]
wait_time = 30.0
autostart = true

[connection signal="mouse_entered" from="draggable" to="." method="_on_draggable_mouse_entered"]
[connection signal="click_end" from="GUILayer_tv/Control/btn_camera" to="." method="_on_btn_camera_click_end"]
[connection signal="timeout" from="glitchtimer" to="." method="_on_glitchtimer_timeout"]

[editable path="draggable"]
